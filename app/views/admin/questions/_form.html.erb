<%= form_for(question, url: url) do |f| %>
  <%= f.label(:title) %>
  <%= f.text_field(:title, required: true, class: "rounded-md xl:w-3/4") %>

  <% if fallback_to_builder %>
    <%= hidden_field_tag(:fallback_builder_id, params[:fallback_builder_id]) %>
  <% end %>
  
  <div data-controller="nested-form" data-nested-form-wrapper-selector-value=".prompts-form-wrapper" class="my-3 xl:w-3/4">
    <h5 class="mb-1">Prompts</h5>
    <template data-nested-form-target="template">
      <%= f.fields_for :prompts, Prompt.new, child_index: 'NEW_RECORD' do |prompt_fields| %>
        <%= render "prompt_form", f: prompt_fields %>
      <% end %>
    </template>

    <%= f.fields_for :prompts do |prompt_fields| %>
      <%= render("prompt_form", f: prompt_fields) %>
    <% end %>
  
    <!-- Inserted elements will be injected before that target. -->
    <div data-nested-form-target="target"></div>
    <button type="button" data-action="nested-form#add" class="btn btn-primary btn-small">Add New Prompt</button>
  </div>

  <div data-controller="nested-form" data-nested-form-wrapper-selector-value=".parent-nodes-form-wrapper" class="mb-3 mt-4">
    <h5>Nodes</h5>
    <template data-nested-form-target="template">
      <%= f.fields_for :parent_nodes, ParentNode.new, child_index: 'NEW_RECORD' do |parent_node_fields| %>
        <%= render "parent_node_form", f: parent_node_fields %>
      <% end %>
    </template>

    <%= f.fields_for :parent_nodes do |parent_node_fields| %>
      <%= render("parent_node_form", f: parent_node_fields) %>
    <% end %>
  
    <!-- Inserted elements will be injected before that target. -->
    <div data-nested-form-target="target"></div>
    <button type="button" data-action="nested-form#add" class="btn btn-primary btn-small mt-3">Add New Node</button>
  </div>

  <div data-controller="questions">
    <div data-questions-target="aiPromptAttached">
      <p>Attach a custom AI prompt</p>
      <%= f.check_box(:ai_prompt_attached, data: { action: "questions#toggleAiPromptContainerView" }) %>
    </div> 

    <div data-questions-target="aiPrompt">
      <p>Provide a custom AI prompt</p>
      <%= f.text_area(:ai_prompt) %>
    </div>
  </div>

  <%= f.submit("Save Question", class: "btn btn-primary my-3") %>
<% end %>
