<header class="main-content__header flex justify-between items-center mb-4 px-4 shadow-md py-4" role="banner">
  <h3 class="main-content__page-title">
    Stories
  </h3>
</header>

<!-- Organization Stories -->
<div class="xl:container mx-auto pt-4 px-4">
  <h4>Organization Stories</h4>
  <div class="overflow-x-auto">
    <table class="border border-collapse mt-5">
      <thead>
        <tr>
          <th>Story Details</th>
          <th>Created By</th>
          <th>Status</th>
          <% if @admin_logged_in %>
            <th>Team Access</th>
          <% end %>
          <th class="text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if @org_stories.present? %>
          <% @org_stories.each do |story| %>
            <tr>
              <td>
                <%= story.title %>
                <div class="text-neutral-500"><%= story.story_builder.title %></div>
              </td>
              <td>
                <%= story.creator.name %>
              </td>
              <td><%= story.status.to_s.capitalize %></td>
              <% if @admin_logged_in %>
                <td>
                  <div class="flex items-center w-full">
                    <label for="viewable<%= story.id %>" class="flex items-center cursor-pointer">
                      <div class="relative" data-controller="tooltip" data-tippy-content="Make it Viewable/Non-viewable for whole organization">
                        <input id="viewable<%= story.id %>" type="checkbox" class="sr-only" data-controller="stories"
                          data-id="<%= story.id %>" data-action="click->stories#toggleStoryVisibility" <%= story.viewable ? "checked" : "" %>>
                        <div class="w-10 h-4 line bg-gray-300 rounded-full shadow-inner"></div>
                        <div class="dot absolute w-6 h-6 bg-white rounded-full shadow -left-1 -top-1 transition"></div>
                      </div>
                      <div class="ml-3 text-gray-700 font-medium" id="viewableTextContainer<%= story.id %>"><%= story.viewable ? "Viewable" : "Non-viewable" %></div>
                    </label>
                  </div>
                </td>
              <% end %>
              <td>
                <div class="flex items-center gap-2 justify-end" >
                  <%= link_to(edit_account_story_path(story, account_id: current_account.id), class: "btn btn-primary", data: { controller: "tooltip", tippy_content: "Show" }) do %>
                    <i class="fa-solid fa-eye"></i>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="6" class="text-center">No Organizations stories found</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <% if @pagy_1.pages > 1 %>
    <div class="mt-6 text-right">
      <%== pagy_nav(@pagy_1) %>
    </div>
  <% end %>
</div>

<!-- My Stories -->
<div class="xl:container mx-auto pb-4 px-4">
  <h4>My Stories</h4>
  <div class="overflow-x-auto">
    <table class="border border-collapse mt-5">
      <thead>
        <tr>
          <th>Story Details</th>
          <th>Status</th>
          <th>Access</th>
          <th class="text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if @my_stories.present? %>
          <% @my_stories.each do |story| %>
            <tr>
              <td>
                <%= story.title %>
                <div class="text-neutral-500"><%= story.story_builder.title %></div>
              </td>
              <td><%= story.status.to_s.capitalize %></td>
              <td>
                <div class="flex items-center w-full">
                  <label for="access<%= story.id %>" class="flex items-center cursor-pointer" data-controller="tooltip" data-tippy-content="Mark story as Private/Public">
                    <div class="relative" data-controller="stories">
                      <% if story.private_access %>
                        <input id="access<%= story.id %>" type="checkbox" class="sr-only"
                          data-id="<%= story.id %>"
                          checked
                          data-account-id="<%= current_account.id %>"
                          data-change-access-mode="on"
                          data-draft-mode="off"
                          data-action="change->stories#updateStoryAccessOrDraftMode">
                      <% else %>
                        <input id="access<%= story.id %>" type="checkbox" class="sr-only"
                          data-id="<%= story.id %>"
                          data-account-id="<%= current_account.id %>"
                          data-change-access-mode="on"
                          data-draft-mode="off"
                          data-action="change->stories#updateStoryAccessOrDraftMode">
                      <% end %>
                      <div class="w-10 h-4 line bg-gray-300 rounded-full shadow-inner"></div>
                      <div class="dot absolute w-6 h-6 bg-white rounded-full shadow -left-1 -top-1 transition"></div>
                    </div>
                    <div class="ml-3 text-gray-700 font-medium" id="privateAccess<%= story.id %>"><%= story.private_access === true ? 'Private' : 'Public' %></div>
                  </label>
                </div>
              </td>
              <td>
                <div class="flex items-center gap-2 justify-end" >
                  <%= link_to(edit_account_story_path(story, account_id: current_account.id), class: "btn btn-primary", data: { controller: "tooltip", tippy_content: "Edit" }) do %>
                    <i class="fa-solid fa-pen"></i>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="5" class="text-center">No stories found</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <% if @pagy_2.pages > 1 %>
    <div class="mt-6 text-right">
      <%== pagy_nav(@pagy_2) %>
    </div>
  <% end %>
</div>