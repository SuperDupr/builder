<div class="p-3 border border-gray-200 py-20 px-5 rounded-sm mt-4 prompt-height flex flex-col justify-between items-center gap-6">
  <% if @prompts.any? %>
    <div id="answerProvider" data-prompt-mode="on" class="w-full">
      <div class="flex items-center justify-between w-full gap-2 mb-6">
        <h5>
          Prompts
          <span class="font-normal" id="promptCountContainer">
            <span id="promptNumber">1</span>
            /
            <span id="promptsCount"><%= @prompts.count %></span>
          </span>
        </h5>
        <div class="flex items-center justify-between gap-2">
          <i class="fa-solid fa-circle-arrow-left fa-2x cursor-pointer text-primary pointer-events-none opacity-50 <%= @prompts.count <= 1 ? '!hidden' : '' %>" id="promptBackward" data-action="click->stories#promptNavigation" data-cursor="backward"></i>
          <i class="fa-solid fa-circle-arrow-right fa-2x cursor-pointer text-primary <%= @prompts.count <= 1 ? '!hidden' : '' %>" id="promptForward" data-action="click->stories#promptNavigation" data-cursor="forward"></i>
        </div>
      </div>
      <div id="promptContainer" class="flex items-center gap-3 flex-wrap justify-center" data-id="<%= @prompt.id %>">
        <div id="promptPreText"><%= @prompt.pre_text %></div>
          <select id="nodes" class="!w-auto" data-action="change->stories#disableNavigationButtonsOnChange">
            <option selected value="">Select option</option>
            <% @nodes.each do |node| %>
              <% if node.child_nodes.any? %>
                <optgroup label="<%= node.title %>">
                  <% node.child_nodes.each do |child_node| %>
                    <option value="<%= child_node.id %>" <%= child_node.title == @prompt.selector ? 'selected' : '' %>>
                      <%= child_node.title %>
                    </option>
                  <% end %>
                </optgroup>
              <% else %>
                <option value="<%= node.id %>" <%= node.title == @prompt.selector ? 'selected' : '' %>>
                  <%= node.title %>
                </option>
              <% end %>
            <% end %>
          </select>
        <div id="promptPostText"><%= @prompt.post_text %></div>
      </div>
      <div id="errorText" class="text-red-500 text-center mt-1 hidden">Please select an option to save response</div>
    </div>
  <% else %>
    <% if @nodes.present? %>
      <div id="answerProvider" class="w-full" data-prompt-mode="off" data-only-node-mode="on">
        <h5 class="w-full mb-6">Select an option</h5>
        <select id="nodes" class="md:!w-2/3 xl:!w-1/3" data-action="change->stories#disableNavigationButtonsOnChange">
          <option selected value="">Select option</option>
          <% @nodes.each do |node| %>
            <% if node.child_nodes.any? %>
              <optgroup label="<%= node.title %>">
                <% node.child_nodes.each do |child_node| %>
                  <option value="<%= child_node.id %>" <%= child_node.title == @answer ? 'selected' : '' %>>
                    <%= child_node.title %>
                  </option>
                <% end %>
              </optgroup>
            <% else %>
              <option value="<%= node.id %>" <%= node.title == @answer ? 'selected' : '' %>>
                <%= node.title %>
              </option>
            <% end %>
          <% end %>
        </select>
        <div id="errorText" class="text-red-500 text-center mt-1 hidden">Please select an option to save response</div>
      </div>
    <% else %>
      <div id="answerProvider" class="w-full" data-prompt-mode="off" data-only-node-mode="off">
        <h5 class="w-full mb-6">Answer</h5>
        <%= text_area_tag(:answer, @answer, class: "form-control lg:w-2/3 xl:w-1/2", placeholder: "Provide your answer here..", rows: 3, data: {action: 'input->stories#disableNavigationButtonsOnChange'}) %>
        <div id="errorText" class="text-red-500 text-center mt-1 hidden">Please write answer to save response</div>
      </div>
    <% end %>
  <% end %>
  <%= render("question_navigation") %>
</div>